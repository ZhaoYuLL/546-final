<title>My User Profile</title>

<div class="profile picture">
  <div class="profile-pic"></div>
</div>
<div>
  <p id="welcome">Welcome {{firstName}} {{lastName}}</p>
  <h2 id="userName">{{userName}}</h2>
</div>
<div></div>
<div class="container">
  <section class="profile"></section>
  <div class="bio"></div>
</div>

<div class="fitposts-container">
  <h1>My fitposts</h1>
  {{#each allFitposts}}
  <div class="fitpost">
    <h1>Fitpost {{addOne @index}}</h1>
    <p>Headwear:</p>
    <img
      src="{{this.headUrl}}"
      width="200px;"
      height="200px"
      alt="Head Image"
    />
    <p>Bodywear:</p>
    <img
      src="{{this.bodyUrl}}"
      width="200px;"
      height="200px"
      alt="Body Image"
    />
    <p>Legwear:</p>
    <img src="{{this.legUrl}}" width="200px;" height="200px" alt="Leg Image" />
    <p>Footwear:</p>
    <img
      src="{{this.footUrl}}"
      width="200px;"
      height="200px"
      alt="Foot Image"
    />

    <button class="edit-fitpost" data-fitpost-id="{{this._id}}">Edit</button>
    <button class="delete-fitpost" data-fitpost-id="{{this._id}}">
      Delete
    </button>
  </div>
  {{/each}}
</div>

<!-- Edit Fitpost Modal -->
<div id="editFitpostModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Edit Fitpost</h2>
    <form id="editFitpostForm">
      <input type="hidden" id="editFitpostId" name="fitpostId" />
      <label for="editHeadwearSelect">Headwear:</label>
      <select id="editHeadwearSelect" name="headwearSelect"></select>
      <label for="editBodywearSelect">Bodywear:</label>
      <select id="editBodywearSelect" name="bodywearSelect"></select>
      <label for="editLegwearSelect">Legwear:</label>
      <select id="editLegwearSelect" name="legwearSelect"></select>
      <label for="editFootwearSelect">Footwear:</label>
      <select id="editFootwearSelect" name="footwearSelect"></select>
      <button type="submit">Update Fitpost</button>
    </form>
  </div>
</div>

<a id="logoutLink" href="/logout">Logout</a>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="/public/js/ajax_jquery.js"></script>

<script>
    var outfitpieces = {{{outfitpiecesJson}}};

    document.addEventListener("DOMContentLoaded", function () {
      // Add event listener to the "Edit" button
      var editButtons = document.querySelectorAll(".edit-fitpost");
      editButtons.forEach(function (button) {
        button.addEventListener("click", function () {
          var fitpostId = button.dataset.fitpostId;
          openEditModal(fitpostId);
        });
      });

      // Add event listener to the form submission
      var editFitpostForm = document.getElementById("editFitpostForm");
      editFitpostForm.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent default form submission

        // Here you can handle the form submission, e.g., sending data to the server via AJAX
        var fitpostId = document.getElementById("editFitpostId").value;
        var headwearSelectValue = document.getElementById("editHeadwearSelect").value;
        var bodywearSelectValue = document.getElementById("editBodywearSelect").value;
        var legwearSelectValue = document.getElementById("editLegwearSelect").value;
        var footwearSelectValue = document.getElementById("editFootwearSelect").value;

        // Example AJAX request (you can modify this according to your backend setup)
        var formData = {
          fitpostId: fitpostId,
          headwear: headwearSelectValue,
          bodywear: bodywearSelectValue,
          legwear: legwearSelectValue,
          footwear: footwearSelectValue,
        };

        // Perform AJAX request
        $.ajax({
          url: "/api/edit-fitpost",
          method: "POST",
          data: formData,
          success: function (response) {
            console.log("Fitpost updated successfully:", response);
            // Optionally, you can close the modal after successful submission
            var modal = document.getElementById("editFitpostModal");
            modal.style.display = "none";
          },
          error: function (xhr, status, error) {
            console.error("Error updating fitpost:", error);
            // Optionally, display an error message to the user
          },
        });
      });
    });

    function openEditModal(fitpostId) {
      // Get the select element references
      var headwearSelect = document.getElementById("editHeadwearSelect");
      var bodywearSelect = document.getElementById("editBodywearSelect");
      var legwearSelect = document.getElementById("editLegwearSelect");
      var footwearSelect = document.getElementById("editFootwearSelect");

      // Clear existing options
      headwearSelect.innerHTML = "";
      bodywearSelect.innerHTML = "";
      legwearSelect.innerHTML = "";
      footwearSelect.innerHTML = "";

      // Populate dropdown menus with images
      // Populate dropdown menus with images
  var fitpostCount = document.querySelectorAll(".fitpost").length;
  for (var i = 0; i < fitpostCount; i++) {
    var fitpost = document.querySelectorAll(".fitpost")[i];
    var headUrl = fitpost.querySelector("img[alt='Head Image']").getAttribute("src");
    var bodyUrl = fitpost.querySelector("img[alt='Body Image']").getAttribute("src");
    var legUrl = fitpost.querySelector("img[alt='Leg Image']").getAttribute("src");
    var footUrl = fitpost.querySelector("img[alt='Foot Image']").getAttribute("src");

    var headOption = document.createElement("option");
    headOption.value = "fitpost" + (i + 1);
    headOption.setAttribute("data-image", headUrl);
    headOption.textContent = "Fitpost " + (i + 1);
    headwearSelect.appendChild(headOption);

    var bodyOption = document.createElement("option");
    bodyOption.value = "fitpost" + (i + 1);
    bodyOption.setAttribute("data-image", bodyUrl);
    bodyOption.textContent = "Fitpost " + (i + 1);
    bodywearSelect.appendChild(bodyOption);

    var legOption = document.createElement("option");
    legOption.value = "fitpost" + (i + 1);
    legOption.setAttribute("data-image", legUrl);
    legOption.textContent = "Fitpost " + (i + 1);
    legwearSelect.appendChild(legOption);

    var footOption = document.createElement("option");
    footOption.value = "fitpost" + (i + 1);
    footOption.setAttribute("data-image", footUrl);
    footOption.textContent = "Fitpost " + (i + 1);
    footwearSelect.appendChild(footOption);
  }

      // Customize the appearance of the dropdown options
      var selectElements = document.querySelectorAll("select");
      selectElements.forEach(function (selectElement) {
        selectElement.style.width = "200px";
        selectElement.style.height = "200px";
        selectElement.style.backgroundSize = "cover";
        selectElement.style.backgroundRepeat = "no-repeat";
        selectElement.style.backgroundPosition = "center";
        selectElement.style.padding = "10px";

        selectElement.addEventListener("change", function () {
          var selectedOption = this.options[this.selectedIndex];
          var imageUrl = selectedOption.getAttribute("data-image");
          this.style.backgroundImage = "url('" + imageUrl + "')";
        });
      });

      // Show the edit modal
      var modal = document.getElementById("editFitpostModal");
      modal.style.display = "block";

      // Set the fitpost ID in the hidden input field
      document.getElementById("editFitpostId").value = fitpostId;
    }

    // Close the modal when the close button is clicked
    var closeBtn = document.getElementsByClassName("close")[0];
    closeBtn.onclick = function () {
      var modal = document.getElementById("editFitpostModal");
      modal.style.display = "none";
    };

    // Function to display the image dynamically
    function displayImage(imageUrl) {
      var imgElement = document.createElement("img");
      imgElement.src = imageUrl;
      imgElement.alt = "Dynamic Image";
      imgElement.width = 200;
      imgElement.height = 200;

      var container = document.querySelector(".container");
      container.appendChild(imgElement);
    }

    // Example usage of displayImage function
    var imageUrl = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRS1u05OPc7MSt9f5Dg2QMSbRPu_FHowIjog-jxeSwHIw&s";
    displayImage(imageUrl);
</script>
