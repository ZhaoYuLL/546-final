<!DOCTYPE html>
<html>
  <head>
    <title>Closet</title>
    <script src="script.js"></script>
  </head>
  <body>
    <h1>Closet</h1>

    <nav>
      <ul>
        <li><a href="./wardrobe">Wardrobe</a></li>
        <li><a href="./closet">Closet</a></li>
        <li><a href="./favorites">Favorites</a></li>
      </ul>
    </nav>

    <div class="outfits">
      <div class="outfit-previews">
        <div class="preview-content">
          <p>Selected Outfits:</p>
          <div class="outfit-preview" data-type="head">
            <p>Head: <span class="preview-outfit" data-type="head"></span></p>
            <button class="prev-button" data-type="head">
              Previous Outfit
            </button>
            <button class="next-button" data-type="head">Next Outfit</button>
          </div>
          <div class="outfit-preview" data-type="body">
            <p>Body: <span class="preview-outfit" data-type="body"></span></p>
            <button class="prev-button" data-type="body">
              Previous Outfit
            </button>
            <button class="next-button" data-type="body">Next Outfit</button>
          </div>
          <div class="outfit-preview" data-type="leg">
            <p>Leg: <span class="preview-outfit" data-type="leg"></span></p>
            <button class="prev-button" data-type="leg">Previous Outfit</button>
            <button class="next-button" data-type="leg">Next Outfit</button>
          </div>
          <div class="outfit-preview" data-type="foot">
            <p>Foot: <span class="preview-outfit" data-type="foot"></span></p>
            <button class="prev-button" data-type="foot">
              Previous Outfit
            </button>
            <button class="next-button" data-type="foot">Next Outfit</button>
          </div>
        </div>
      </div>

      <div class="outfit-list">
        <!-- Outfit list will be populated dynamically -->
      </div>
    </div>
  </body>
</html>

<script>
  var outfitpieces = {{{outfitpiecesJson}}};

  var currentIndex = {};

  document.addEventListener("DOMContentLoaded", function () {
    // Initialize currentIndex for each outfit type
    var outfitTypes = Array.from(new Set(outfitpieces.map(outfit => outfit.outfitType)));
    outfitTypes.forEach(type => {
      currentIndex[type] = 0;
    });

    var nextButtons = document.getElementsByClassName("next-button");
    for (var i = 0; i < nextButtons.length; i++) {
      nextButtons[i].addEventListener("click", nextOutfit);
    }

    var prevButtons = document.getElementsByClassName("prev-button");
    for (var i = 0; i < prevButtons.length; i++) {
      prevButtons[i].addEventListener("click", previousOutfit);
    }

    updateOutfitPreviews();
    populateOutfitList();
  });

  function nextOutfit(event) {
    var selectedType = event.target.getAttribute("data-type");
    var outfits = outfitpieces.filter(outfit => outfit.outfitType === selectedType);
    currentIndex[selectedType] = (currentIndex[selectedType] + 1) % outfits.length;
    updateOutfitPreviews();
  }

  function previousOutfit(event) {
    var selectedType = event.target.getAttribute("data-type");
    var outfits = outfitpieces.filter(outfit => outfit.outfitType === selectedType);
    currentIndex[selectedType] = (currentIndex[selectedType] - 1 + outfits.length) % outfits.length;
    updateOutfitPreviews();
  }

  function updateOutfitPreviews() {
    var outfitTypes = Array.from(new Set(outfitpieces.map(outfit => outfit.outfitType)));
    outfitTypes.forEach(type => {
      var outfits = outfitpieces.filter(outfit => outfit.outfitType === type);
      if (outfits.length > 0) {
        var selectedOutfit = outfits[currentIndex[type]];
        var imageUrl = selectedOutfit.imageUrl;
        var imageTag = '<img width="200px;" height="200px" src="' + imageUrl + '" alt="Outfit Image">';
        document.querySelector(`.preview-outfit[data-type="${type}"]`).innerHTML = imageTag;
      }
    });
  }

  function populateOutfitList() {
    var outfitList = document.querySelector(".outfit-list");
    outfitpieces.forEach(outfit => {
      var outfitDiv = document.createElement("div");
      outfitDiv.className = "outfit";
      outfitDiv.setAttribute("data-type", outfit.outfitType);
      outfitDiv.innerHTML = `
        <img src="${outfit.imageUrl}" width="200px;" height="200px" alt="Outfit Image" />
        <p>Username: ${outfit.username}</p>
      `;
      outfitList.appendChild(outfitDiv);
    });
  }
</script>
